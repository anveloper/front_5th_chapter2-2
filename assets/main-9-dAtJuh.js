import{r as i,j as e,c as L,R as V}from"./client-DD4c7S6m.js";const U={AMOUNT:"amount",PERCENTAGE:"percentage"},g={USER:"user",ADMIN:"admin"},b={CART:"cart",ADMIN:"admin"},O={CART:"cart",COUPON:"coupon",PRODUCT:"product"},$=t=>t.reduce((s,n)=>Math.max(s,n.rate),0),k=({quantity:t,product:{discounts:s}})=>s.reduce((n,{quantity:o,rate:c})=>t>=o?Math.max(n,c):n,0),F=t=>t.reduce(({totalBeforeDiscount:s,quantityDiscount:n},o)=>{const c=o.product.price*o.quantity;return{totalBeforeDiscount:s+c,quantityDiscount:n+c*k(o)}},{totalBeforeDiscount:0,quantityDiscount:0}),_=(t,s,n)=>t?t.discountType===U.AMOUNT?t.discountValue:(s-n)*(t.discountValue/100):0,B=(t,s)=>{if(!t.length)return{totalBeforeDiscount:0,totalAfterDiscount:0,totalDiscount:0};const{totalBeforeDiscount:n,quantityDiscount:o}=F(t),c=_(s,n,o),a=o+c,x=n-a;return{totalBeforeDiscount:n,totalAfterDiscount:x,totalDiscount:a}},y=(t,s,n)=>n===0?t.filter(({product:o})=>o.id!==s):t.map(o=>{if(o.product.id!==s)return o;const c=o.product.stock>=n?n:o.product.stock;return{...o,quantity:c}}),Y=(t,s)=>{const n=[...t],o=n.findIndex(c=>c.product.id===s.id);if(o!==-1){const c=n[o],a=Math.min(c.quantity+1,s.stock);return n[o]={...c,quantity:a},n}return[...n,{product:s,quantity:1}]},W=(t,s)=>{const n=[...t],o=n.findIndex(c=>c.id===s.id);return o===-1||(n[o]=s),n},G=(t,s)=>t===b.CART&&s?b.ADMIN:t===b.ADMIN?b.CART:t,J=()=>{const[t,s]=X(O.CART,[]),[n,o]=i.useState(null),c=i.useCallback(r=>{s(d=>Y(d,r))},[]),a=i.useCallback(r=>{s(d=>y(d,r,0))},[]),x=i.useCallback((r,d)=>{s(m=>y(m,r,d))},[]),h=i.useCallback(r=>{o(r)},[]),l=()=>B(t,n),u=i.useCallback(r=>{const d=t.find(m=>m.product.id===r.id);return r.stock-((d==null?void 0:d.quantity)||0)},[t]);return{cart:t,addToCart:c,removeFromCart:a,updateQuantity:x,applyCoupon:h,calculateTotal:l,selectedCoupon:n,getRemainingStock:u}},K=t=>{const[s,n]=i.useState(t),o=i.useCallback(c=>{n(a=>[...a,c])},[]);return{coupons:s,addCoupon:o}},D=(t,s)=>(localStorage.setItem(t,JSON.stringify(s)),s),Q=(t,s)=>{try{const n=localStorage.getItem(t);if(n)return JSON.parse(n)}catch{}return D(t,s),s},z=t=>typeof t=="function",H=(t,s,n)=>{const o=z(n)?n(s):n;return D(t,o),o},X=(t,s)=>{const[n,o]=i.useState(()=>Q(t,s));return[n,a=>{o(x=>H(t,x,a))}]},Z=t=>{const[s,n]=i.useState(t),o=i.useCallback(a=>{n(x=>W(x,a))},[]),c=i.useCallback(a=>{n(x=>[...x,a])},[]);return{products:s,updateProduct:o,addProduct:c}},ee=(t=g.USER)=>{const[s]=i.useState(t),[n,o]=i.useState(b.CART),c=i.useCallback(()=>{o(a=>G(a,s===g.ADMIN))},[s]);return{service:n,isAdminView:n===b.ADMIN,toggleService:c,permission:s,hasAdminPermission:s===g.ADMIN}},A=(...t)=>t.filter(Boolean).join(" "),I=({title:t,children:s})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:t}),s]}),p=({className:t="",...s})=>e.jsx("input",{className:A("w-full p-2 border rounded",t),...s}),v=({id:t,type:s="text",label:n,value:o,onChange:c})=>e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700",children:n}),e.jsx(p,{id:t,type:s,value:o,onChange:c})]}),N=({children:t})=>e.jsx("div",{className:"space-y-2",children:t}),T=({className:t="",children:s,...n})=>e.jsx("select",{className:A("w-full p-2 border rounded",t),...n,children:s}),E=i.createContext(null),te=({children:t})=>{const s=J();return e.jsx(E.Provider,{value:s,children:t})},C=()=>{const t=i.useContext(E);if(!t)throw new Error("context is null");return t},R=i.createContext(null),se=({coupons:t=ne,children:s})=>{const n=K(t);return e.jsx(R.Provider,{value:n,children:s})},f=()=>{const t=i.useContext(R);if(!t)throw new Error("context is null");return t},ne=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],q=i.createContext(null),oe=({products:t=ce,children:s})=>{const n=Z(t);return e.jsx(q.Provider,{value:n,children:s})},j=()=>{const t=i.useContext(q);if(!t)throw new Error("context is null");return t},ce=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ae=({products:t,coupons:s,children:n})=>e.jsx(oe,{products:t,children:e.jsx(se,{coupons:s,children:e.jsx(te,{children:n})})}),re=()=>{const{coupons:t}=f();return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx(N,{children:t.map((s,n)=>e.jsxs("div",{"data-testid":`coupon-${n+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," 할인"]},n))})]})},w={name:"",code:"",discountType:"percentage",discountValue:0},le=()=>{const{addCoupon:t}=f(),[s,n]=i.useState(w),o=()=>{t(s),n(w)};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(p,{type:"text",placeholder:"쿠폰 이름",value:s.name,onChange:c=>n({...s,name:c.target.value})}),e.jsx(p,{type:"text",placeholder:"쿠폰 코드",value:s.code,onChange:c=>n({...s,code:c.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{value:s.discountType,onChange:c=>n({...s,discountType:c.target.value}),children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx(p,{type:"number",placeholder:"할인 값",value:s.discountValue,onChange:c=>n({...s,discountValue:parseInt(c.target.value)})})]}),e.jsx("button",{onClick:o,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})},S={name:"",price:0,stock:0,discounts:[]},ie=({setShowNewProductForm:t})=>{const{addProduct:s}=j(),[n,o]=i.useState(S),c=()=>{const a={...n,id:Date.now().toString()};s(a),o(S),t(!1)};return e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsx(v,{id:"productName",label:"상품명",value:n.name,onChange:a=>o({...n,name:a.target.value})}),e.jsx(v,{id:"productPrice",type:"number",label:"가격",value:n.price,onChange:a=>o({...n,price:parseInt(a.target.value)})}),e.jsx(v,{id:"productStock",type:"number",label:"재고",value:n.stock,onChange:a=>o({...n,stock:parseInt(a.target.value)})}),e.jsx("button",{onClick:c,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})},P={quantity:0,rate:0},de=({product:t,editingProduct:s,setEditingProduct:n})=>{const{products:o,updateProduct:c}=j(),[a,x]=i.useState(P),h=(u,r)=>{const d=o.find(m=>m.id===u);if(d){const m={...d,discounts:d.discounts.filter((we,M)=>M!==r)};c(m),n(m)}},l=u=>{const r=o.find(d=>d.id===u);if(r&&s){const d={...r,discounts:[...r.discounts,a]};c(d),n(d),x(P)}};return e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),s.discounts.map((u,r)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[u.quantity,"개 이상 구매 시 ",u.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>h(t.id,r),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},r)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:a.quantity,onChange:u=>x({...a,quantity:parseInt(u.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:a.rate*100,onChange:u=>x({...a,rate:parseInt(u.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>l(t.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]})},ue=({product:t,setEditingProduct:s})=>{const n=o=>{s({...o})};return e.jsxs("div",{children:[t.discounts.map((o,c)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[o.quantity,"개 이상 구매 시 ",o.rate*100,"% 할인"]})},c)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>n(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})},xe=({product:t,editingProduct:s,setEditingProduct:n})=>{const{products:o,updateProduct:c}=j(),a=(l,u)=>{if(s&&s.id===l){const r={...s,name:u};n(r)}},x=(l,u)=>{if(s&&s.id===l){const r={...s,price:u};n(r)}},h=(l,u)=>{const r=o.find(d=>d.id===l);if(r){const d={...r,stock:u};c(d),n(d)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx(p,{type:"text",value:s.name,onChange:l=>a(t.id,l.target.value)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx(p,{type:"number",value:s.price,onChange:l=>x(t.id,parseInt(l.target.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx(p,{type:"number",value:s.stock,onChange:l=>h(t.id,parseInt(l.target.value))})]})]})},me=()=>{const{products:t,updateProduct:s}=j(),[n,o]=i.useState(new Set),[c,a]=i.useState(null),x=l=>{o(u=>{const r=new Set(u);return r.has(l)?r.delete(l):r.add(l),r})},h=()=>{c&&(s(c),a(null))};return e.jsx(N,{children:t.map((l,u)=>e.jsxs("div",{"data-testid":`product-${u+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>x(l.id),className:"w-full text-left font-semibold",children:[l.name," - ",l.price,"원 (재고: ",l.stock,")"]}),n.has(l.id)&&e.jsx("div",{className:"mt-2",children:c&&c.id===l.id?e.jsxs("div",{children:[e.jsx(xe,{product:l,editingProduct:c,setEditingProduct:a}),e.jsx(de,{product:l,editingProduct:c,setEditingProduct:a}),e.jsx("button",{onClick:h,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsx(ue,{product:l,setEditingProduct:a})})]},l.id))})},he=()=>{const[t,s]=i.useState(!1);return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>s(!t),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:t?"취소":"새 상품 추가"}),t&&e.jsx(ie,{setShowNewProductForm:s}),e.jsx(me,{})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(le,{}),e.jsx(re,{})]})]})]})]})},pe=()=>{const{cart:t,removeFromCart:s,updateQuantity:n}=C();return e.jsx(N,{children:t.map(o=>{const c=k(o);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:o.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o.product.price,"원 x ",o.quantity,c>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(o.product.id,o.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>n(o.product.id,o.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>s(o.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},o.product.id)})})},be=({product:t})=>t.discounts.length?e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((s,n)=>e.jsxs("li",{children:[s.quantity,"개 이상: ",(s.rate*100).toFixed(0),"% 할인"]},n))}):null,je=({product:t,children:s})=>{const{addToCart:n,getRemainingStock:o}=C(),c=o(t);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${c>0?"text-green-600":"text-red-600"}`,children:["재고: ",c,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",($(t.discounts)*100).toFixed(0),"% 할인"]})]}),s,e.jsx("button",{onClick:()=>n(t),className:`w-full px-3 py-1 rounded ${c>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:c<=0,children:c>0?"장바구니에 추가":"품절"})]})},ge=()=>{const{products:t}=j();return e.jsx(N,{children:t.map(s=>e.jsx(je,{product:s,children:e.jsx(be,{product:s})},s.id))})},Ne=()=>{const{coupons:t}=f(),{applyCoupon:s,selectedCoupon:n}=C();return e.jsxs(I,{title:"쿠폰 적용",children:[e.jsxs(T,{onChange:o=>s(t[parseInt(o.target.value)]),className:"mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((o,c)=>e.jsxs("option",{value:c,children:[o.name," -"," ",o.discountType==="amount"?`${o.discountValue}원`:`${o.discountValue}%`]},o.code))]}),n&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",n.name,"(",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`," ","할인)"]})]})},Ce=()=>{const{calculateTotal:t}=C(),{totalBeforeDiscount:s,totalAfterDiscount:n,totalDiscount:o}=t();return e.jsx(I,{title:"주문 요약",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})})},ve=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx(ge,{})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(pe,{}),e.jsx(Ne,{}),e.jsx(Ce,{})]})]})]}),fe=g.ADMIN,ye=()=>{const{isAdminView:t,toggleService:s}=ee(fe);return e.jsx(ae,{children:e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:s,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(he,{}):e.jsx(ve,{})})]})})};L.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(ye,{})}));
